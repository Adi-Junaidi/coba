<table style="empty-cells: show; min-width: 100%; border-collapse: collapse; background-color: white;" cellpadding="0" cellspacing="0" border="0">
  <thead>
    <tr style="height:46px" valign="top">
      <td style="white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" colspan="10">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 16px; line-height: 1.1640625; font-weight: bold;">JUMLAH PUSAT INFORMASI DAN KONSELING REMAJA DAN MAHASISWA (PIK REMAJA)<br>YANG MELAKUKAN PERTEMUAN DAN REMAJA HADIR PERTEMUAN</span>
      </td>
    </tr>
    <tr style="height:26px" valign="top">
      <td style="white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" colspan="10">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 16px; line-height: 1.1640625; font-weight: bold;">BULAN: MEI - 2023</span>
      </td>
    </tr>
    <tr style="height:26px" valign="top">
      <td style="white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: left;" colspan="10">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 12px; line-height: 1.1640625; font-weight: bold;">Prov: GORONTALO</span>
      </td>
    </tr>
    <tr style="height:30px" valign="top">
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" rowspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">KODE</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" rowspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFCFC; font-size: 8px; line-height: 1.1640625; font-weight: bold;">KABUPATEN</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" colspan="3">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">PIK REMAJA</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" colspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">JUMLAH PIK REMAJA<br />YANG MENYAJIKAN MATERI</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" rowspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">JUMLAH<br />PERTEMUAN</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" rowspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">JUMLAH REMAJA<br>HADIR DALAM<br>PERTEMUAN</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" rowspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">JUMLAH PERTEMUAN<br>MATERI PKBR OLEH<br>PIK REMAJA</span>
      </td>
    </tr>
    <tr style="height:80px" valign="top">
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">YANG<br />ADA</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">YANG<br />LAPOR</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">%</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">PKBR</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 8px; line-height: 1.1640625; font-weight: bold;">LAINNYA</span>
      </td>
    </tr>
    <tr style="height:17px" valign="top">
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">1</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">2</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">3</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">4</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">5=4/3*100</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">6</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">7</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">8</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">9</span>
      </td>
      <td style="background-color: #0099FF; border: 1px solid #FFFFFF; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">10</span>
      </td>
    </tr>
  </thead>

  <tbody>
    @php
      $total = [
          'pikrs' => 0,
          'reported' => 0,
          'percentage' => 0,
          'servedPKBR' => 0,
          'servedLainnya' => 0,
      ];
      
    @endphp
    @foreach ($kabkotas as $kabkota)
      @php
        $pikrs = $kabkota->pikrs;
        // pikr yang melapor pasti memiliki setidaknya satu laporan yang verified di bulan yang dipilih
        $reported = $pikrs->filter(fn($pikr) => $pikr->verified_laporans->filter(fn($laporan) => $laporan->bulan_lapor === $filters['bulan'])->count() > 0);
        
        // pikr yang menyajikan materi PKBR dan materi Lainnya
        // it's painful I know, but at least it works I'm okay for now
        $servedPKBR = $pikrs->filter(fn($pikr) => $pikr->verified_laporans->filter(fn($laporan) => $laporan->bulan_lapor === $filters['bulan'])->contains(fn($laporan) => $laporan->pelayananInformasi->contains(fn($pelayananInformasi) => !!$pelayananInformasi->materi) || $laporan->konseling->contains(fn($konseling) => !!$konseling->materi) || $laporan->konselingKelompok->contains(fn($konselingKelompok) => !!$konselingKelompok->materi)));
        $servedLainnya = $pikrs->filter(fn($pikr) => $pikr->verified_laporans->filter(fn($laporan) => $laporan->bulan_lapor === $filters['bulan'])->contains(fn($laporan) => $laporan->pelayananInformasi->contains(fn($pelayananInformasi) => !!$pelayananInformasi->materi_lainnya) || $laporan->konseling->contains(fn($konseling) => !!$konseling->materi_lainnya) || $laporan->konselingKelompok->contains(fn($konselingKelompok) => !!$konselingKelompok->materi_lainnya)));
        
        $percentage = 0;
        // avoid division by zero
        if ($pikrs->count() > 0) {
            $percentage = ($reported->count() / $pikrs->count()) * 100;
        }
        
        $total['pikrs'] += $pikrs->count();
        $total['reported'] += $reported->count();
        $total['percentage'] += $percentage;
        $total['servedPKBR'] += $servedPKBR->count();
        $total['servedLainnya'] += $servedLainnya->count();
      @endphp
      <tr style="height:30px" valign="top">
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ $kabkota->kode }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: left;">
          <div style="padding-left:5px;"><span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1; *line-height: normal;">{{ $kabkota->parsedNama() }}</span></div>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ $pikrs->count() }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ $reported->count() }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ number_format($percentage, 2, '.', '') }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ $servedPKBR->count() }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">{{ $servedLainnya->count() }}</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">8</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">69</span>
        </td>
        <td style="border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
          <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #000000; font-size: 10px; line-height: 1.1640625;">8</span>
        </td>
      </tr>
    @endforeach
  </tbody>

  <tfoot>
    <tr style="height:30px" valign="top">
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;" colspan="2">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 12px; line-height: 1.1640625; font-weight: bold;">JUMLAH TOTAL</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">{{ $total['pikrs'] }}</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">{{ $total['reported'] }}</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">{{ number_format($total['percentage'], 2, '.', '') }}</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">{{ $total['servedPKBR'] }}</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">{{ $total['servedLainnya'] }}</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">31</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">433</span>
      </td>
      <td style="background-color: #085480; border: 1px solid #0AF0FC; white-space: nowrap; text-indent: 0px;  vertical-align: middle;text-align: center;">
        <span style="font-family: 'DejaVu Sans', Arial, Helvetica, sans-serif; color: #FFFFFF; font-size: 10px; line-height: 1.1640625;">28</span>
      </td>
    </tr>
  </tfoot>
</table>
